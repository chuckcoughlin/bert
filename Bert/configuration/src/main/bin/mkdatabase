#!/bin/sh
#  Build a database for installation on the robot. It contains
#  the current repertoire of poses and actions.
#
#

cd ${BERT_HOME}
DB=bert.db
CSV=${BERT_HOME}/csv
ETC=${BERT_HOME}/etc
SQL=${BERT_HOME}/sql

mkdir -p $ETC
cd ${ETC}
rm -f $DB
#set -x
sqlite3 $DB < ${SQL}/createTables.sql

# Change to CSV mode and load pose and action tables
cd ${CSV}
cat Pose.csv | tail -n+3|sed -e 's/	/,/g' >/tmp/pose
cat PoseMap.csv | tail -n+2|sed -e 's/	/,/g' >/tmp/posemap

cd ${ETC}
sqlite3 $DB << EOF
.mode csv
.import /tmp/pose Pose
.import /tmp/posemap PoseMap
EOF

mv ${DB} ${BERT_HOME}/etc/${DB}
echo "${DB} creation compete."