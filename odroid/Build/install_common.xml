<?xml version="1.0" encoding="UTF-8"?>
<!-- Build the common library and place with the open source modules. -->
<project name="bert.install.common" default="all" basedir=".">
	<property name="archive.dir" value="${basedir}/../Archive/mods" />
	<property name="jar.dir" value="${basedir}/lib" />
	<property name="jar.name" value="bert-common.jar" />
	<property name="build.dir" value="${basedir}/bin" />
	<property name="src.dir" value="${basedir}/../Common/src" />

	<!-- This target will build the core application and deploy it to the robot -->
	<target name="all" depends="clean,build,jar,deploy" />
	
	<!-- Remove the existing target -->
	<target name="clean" description="Remove existing build products">
		<mkdir dir="${build.dir}"/>
		<delete file="${archive.dir}/${jar.name}" />
        <delete dir="${build.dir}"/>
	</target>
	
	<!-- Compile the library -->
	<target name="build" description="Compile the source">
		<mkdir dir="${build.dir}"/>
		<echo message="Compiling with modpath ${archive.dir}" />
		<javac srcdir="${src.dir}"
	       	   destdir="${build.dir}"
		       compiler="javac10+"
			   source="11" target="11"
			   modulepath="${archive.dir}"
		/>
	</target>
	
	<!-- Create/copy the jar file into the current build area -->
	<target name ="jar" description="Create a jar ">
    	<jar destfile="${archive.dir}/${jar.name}" includes="**/*.class,**/*.png" basedir="bin"/>
	</target>
	
	<!-- Copy the jar onto the robot -->
	<target name="deploy" >
		<echo message="Copying jar file onto robot" />
	    <exec executable="rsync" dir="." failonerror="true">
	      <arg value="lib/${jar.name}"/>
	      <arg value="bert:/usr/local/robot/mods"/>
	</exec>
	</target>	
</project>